From 268a1a4e8f4f8ec21cacba578de65fe559fbb13f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Martin=20Storsj=C3=B6?= <martin@martin.st>
Date: Fri, 24 Apr 2020 15:21:58 +0300
Subject: [PATCH 1/4] contrib: ffmpeg: Enable the MediaFoundation encoder
 wrappers

---
 contrib/ffmpeg/module.defs | 4 +++-
 gtk/configure.ac           | 2 +-
 libhb/module.defs          | 2 +-
 test/module.defs           | 2 +-
 4 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/contrib/ffmpeg/module.defs b/contrib/ffmpeg/module.defs
index ebddcf19a..d52104b95 100644
--- a/contrib/ffmpeg/module.defs
+++ b/contrib/ffmpeg/module.defs
@@ -111,7 +111,9 @@ else ifeq (1-mingw,$(HOST.cross)-$(HOST.system))
         --target-os=mingw32 \
         --arch=$(HOST.machine) \
         --cross-prefix=$(HOST.cross.prefix) \
-        --pkg-config=$(PKGCONFIG.exe)
+        --pkg-config=$(PKGCONFIG.exe) \
+        --enable-encoder=h264_mf \
+        --enable-encoder=hevc_mf
     FFMPEG.GCC.args.extra += -fno-common
 endif
 
diff --git a/gtk/configure.ac b/gtk/configure.ac
index 06435c4fc..a9a07c749 100644
--- a/gtk/configure.ac
+++ b/gtk/configure.ac
@@ -231,7 +231,7 @@ case $host in
 		if test "x$use_libpthread" = "xyes" ; then
 			HB_LIBS="$HB_LIBS -lpthread"
 		fi
-		HB_LIBS="$HB_LIBS -lbcrypt -lregex -luuid -lole32"
+		HB_LIBS="$HB_LIBS -lbcrypt -lregex -luuid -lole32 -lmfplat -lstrmiids"
 		;;
 	*-*-freebsd*)
 		HB_LIBS="$HB_LIBS -lpthread"
diff --git a/libhb/module.defs b/libhb/module.defs
index a6aec9702..e5b6e2479 100644
--- a/libhb/module.defs
+++ b/libhb/module.defs
@@ -170,7 +170,7 @@ else
 endif
 
 LIBHB.GCC.args.extra.dylib++ += -Wl,--out-implib,$(LIBHB.lib)
-LIBHB.GCC.l += bcrypt ws2_32 uuid ole32
+LIBHB.GCC.l += bcrypt ws2_32 uuid ole32 mfplat strmiids
 ifeq ($(HAS.dlfcn),1)
     LIBHB.GCC.l += dl
 endif
diff --git a/test/module.defs b/test/module.defs
index 33bee3111..855c34363 100644
--- a/test/module.defs
+++ b/test/module.defs
@@ -89,7 +89,7 @@ ifeq (1,$(HAS.pthread))
 else
     TEST.GCC.l += pthreadGC2
 endif
-    TEST.GCC.l += bcrypt iconv ws2_32 regex uuid ole32
+    TEST.GCC.l += bcrypt iconv ws2_32 regex uuid ole32 mfplat strmiids
     TEST.GCC.D += PTW32_STATIC_LIB
     TEST.GCC.args.extra.exe++ += -static
 endif #   (1-mingw,$(HOST.cross)-$(HOST.system))
-- 
2.20.1

